{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "definitions": {
    "contexts": {
      "type": "object",
      "patternProperties": {
        "^[A-Za-z0-9_]+$": {
          "$ref": "#/definitions/context"
        }
      }
    },
    "context": {
      "if": {
        "properties": {
          "connectionString": {
            "pattern": "sqlite://.+"
          }
        }
      },
      "then": {
        "properties": {
          "connectionString": {
            "type": "string"
          },
          "schemaLocation": {
            "type": "string"
          },
          "schemaName": {
            "type": "string"
          },
          "migrationLocation": {
            "type": "string"
          },
          "authorization": {
            "$ref": "#/definitions/authorization"
          },
          "options": {
            "properties": {
              "dropIfExists": {
                "type": "boolean"
              }
            },
            "additionalProperties": false
          }
        },
        "required": ["connectionString"],
        "additionalProperties": false
      },
      "else": {
        "if": {
          "properties": {
            "connectionString": {
              "pattern": "postgres://.+"
            }
          }
        },
        "then": {
          "properties": {
            "connectionString": {
              "type": "string"
            },
            "schemaLocation": {
              "type": "string"
            },
            "schemaName": {
              "type": "string"
            },
            "migrationLocation": {
              "type": "string"
            },
            "authorization": {
              "$ref": "#/definitions/authorization"
            },
            "options": {
              "properties": {
                "createIfNotExists": {
                  "type": "boolean"
                }
              },
              "additionalProperties": false
            }
          },
          "required": ["connectionString"],
          "additionalProperties": false
        },
        "else": {
          "if": {
            "properties": {
              "connectionString": {
                "pattern": "(http|https)://.+"
              }
            }
          },
          "then": {
            "properties": {
              "connectionString": {
                "type": "string"
              },
              "schemaLocation": {
                "type": "string"
              },
              "schemaName": {
                "type": "string"
              },
              "migrationLocation": {
                "type": "string"
              }
            },
            "required": ["connectionString"],
            "additionalProperties": false
          },
          "else": {
            "additionalProperties": false
          }
        }
      }
    },
    "authorization": {
      "type": "object",
      "properties": {
        "providers": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/authorizationProvider"
          }
        },
        "tokens": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/authorizationToken"
          }
        },
        "cors": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "authorizationProvider": {
      "type": "object",
      "properties": {
        "uri": {
          "type": "string"
        },
        "issuer": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": ["issuer", "uri"]
    },
    "authorizationToken": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "uri": {
          "type": "string"
        },
        "issuer": {
          "type": "string"
        }
      }
    }
  },
  "properties": {
    "context": {
      "$ref": "#/definitions/contexts"
    }
  },
  "required": [
    "context"
  ]
}
